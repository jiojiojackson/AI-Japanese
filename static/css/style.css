:root {
    --font-family-sans: 'Noto Sans JP', sans-serif;
    --background-color: #f4f6f8;
    --surface-color: #ffffff;
    --primary-color: #5B8CFF; /* softer blue */
    --accent-color: #7AE582; /* for success/actions */
    --text-color-main: #0f1724;
    --text-color-muted: #556270;
    --border-color: #dee2e6;
    --error-color: #dc3545;
    --success-color: #28a745;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
    --border-radius: 0.75rem; /* Slightly larger radius */
}

.record-btn.is-hidden {
    display: none;
}


body {
    font-family: var(--font-family-sans);
    background: linear-gradient(180deg, #f7fafc 0%, var(--background-color) 100%);
    color: var(--text-color-main);
    margin: 0;
    padding: 1rem;
    line-height: 1.6;
}

.container {
    width: 100%;
    max-width: 1000px;
    margin: 2rem auto;
    background-color: var(--surface-color);
    border-radius: calc(var(--border-radius) + 0.25rem);
    padding: 1.5rem;
    box-shadow: var(--shadow-md);
    position: relative;
}

h1 { margin: 0; font-weight: 700; }
.brand { display:flex; gap:12px; align-items:center; }
.logo { font-size:32px; }
.app-header { display:flex; justify-content:space-between; align-items:center; padding:0.4rem 0 1rem 0; }
.subtitle { margin:0; color:var(--text-color-muted); font-size:0.95rem }

/* Conversation Area */
#conversation-area {
    height: 64vh;
    overflow-y: auto;
    border-radius: calc(var(--border-radius) - 0.25rem);
    padding: 1rem;
    margin-bottom: 1.25rem;
    background-color: #f8fafc;
    border: 1px solid rgba(15,23,36,0.04);
}

.message { display:flex; flex-direction:column; gap:6px; margin-bottom:1.25rem; max-width:85%; }
.ai-message { align-items:flex-start; }
.user-message { align-items:flex-end; margin-left:auto; }

.speaker { font-weight:600; font-size:0.85rem; color:var(--text-color-muted); }
.ai-message .speaker{ text-align:left }
.user-message .speaker{ text-align:right }

.text-content {
    padding: 0.85rem 1.15rem;
    border-radius: 14px;
    word-break: break-word;
    box-shadow: var(--shadow-sm);
    max-width: 70ch;
}
.ai-message .text-content { background: linear-gradient(180deg,#fff,#fbfdff); border-top-left-radius:4px; color:var(--text-color-main); }
.user-message .text-content { background: linear-gradient(180deg,var(--primary-color), #4f7ef0); color:#fff; border-top-right-radius:4px; }

.text-content.is-hidden { position:relative; filter:blur(4px); cursor:pointer }
.text-content.is-hidden::after { content:'クリックして表示'; position:absolute; inset:0; display:flex; justify-content:center; align-items:center; color:var(--text-color-main); background: linear-gradient(90deg, rgba(255,255,255,0.6), rgba(255,255,255,0.3)); border-radius:14px; font-weight:600 }

.user-message .text-content .error {
    color: #fff;
    background-color: var(--error-color);
    padding: 1px 3px;
    border-radius: 3px;
}

/* User Feedback inside bubble */
.feedback-container { margin-top:0.6rem; padding:0.65rem; border-radius:10px; background:rgba(91,140,255,0.06); font-size:0.95rem }
.feedback-item { margin-bottom:0.5rem }
.feedback-item strong{ color:var(--text-color-main) }

/* Message Buttons */
.message-buttons { margin-top:0.5rem; display:flex; gap:0.5rem }
.message-buttons button{ background:transparent; border:1px solid rgba(15,23,36,0.06); padding:6px 10px; border-radius:10px; cursor:pointer }
.message-buttons button:hover{ background:rgba(91,140,255,0.06) }

/* FIX: Translation text styling */
.translation-text{ font-size:0.95rem; color:var(--text-color-main); margin-top:10px; padding:10px; background:linear-gradient(180deg,#fff,#fbfdff); border-radius:8px }

/* POS Coloring */
.pos-token { font-weight:600; padding:1px 0; margin-right:4px }
.text-content ruby rt{ font-size:0.78rem; opacity:0.95 }
.pos-名詞 { color: #D97706; } /* Noun - Amber */
.pos-動詞 { color: #059669; } /* Verb - Emerald */
.pos-形容詞 { color: #2563EB; } /* Adjective - Blue */
.pos-助詞 { color: #DB2777; } /* Particle - Pink */
.pos-助動詞 { color: #9333EA; } /* Auxiliary Verb - Purple */
.pos-副詞 { color: #6D28D9; } /* Adverb - Violet */
.pos-接続詞 { color: #0D9488; } /* Conjunction - Teal */
.pos-連体詞 { color: #C026D3; } /* Adnominal - Fuchsia */
.pos-感動詞 { color: #65A30D; } /* Interjection - Lime */
.pos-記号, .pos-フィラー, .pos-その他 { color: var(--text-color-muted); }

/* Main Record Button */
#user-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-top: 8px;
}

.record-btn {
    color: white;
    border: none;
    padding: 12px 26px;
    font-size: 1.05rem;
    border-radius: 999px;
    cursor: pointer;
    box-shadow: 0 6px 18px rgba(91, 140, 255, 0.12);
    transition: transform .12s ease;
}
.record-btn:hover { transform: translateY(-3px); }

#record-button { background: var(--primary-color); }

#stop-button { background: var(--error-color); }
#cancel-button { background-color: var(--text-color-muted); }

/* Modals (Settings & Word Card) */
.settings-btn{ background:transparent; border:1px solid rgba(15,23,36,0.06); width:44px; height:44px; border-radius:10px; display:inline-flex; align-items:center; justify-content:center; cursor:pointer }
.settings-btn:hover{ background:rgba(91,140,255,0.06) }

.modal-overlay{ position:fixed; inset:0; background:rgba(10,12,16,0.36); display:flex; align-items:center; justify-content:center; z-index:1200; opacity:0; visibility:hidden; transition:opacity .22s ease }
.modal-overlay:not(.is-hidden){ opacity:1; visibility:visible }
.modal-content{ background:var(--surface-color); padding:1.5rem; border-radius:14px; width:92%; max-width:640px; box-shadow:0 8px 24px rgba(17,24,39,0.08); max-height:86vh; overflow:auto }
.modal-content h2{ margin-top:0; text-align:center; margin-bottom:1.25rem }

/* FIX: Settings Card Layout */
.setting-item{ margin-bottom:1rem }
.setting-item label{ display:block; margin-bottom:0.45rem; font-weight:600; color:var(--text-color-muted) }
.setting-item select, #tts-engine-select{ width:100%; padding:10px; border-radius:8px; border:1px solid rgba(15,23,36,0.06); background:#fff }
#tts-engine-select{ display:flex; gap:12px; align-items:center }
#tts-engine-select label{ cursor:pointer }
#tts-engine-select input{ margin-right:6px }

#close-settings-button, #close-word-card-button{ display:block; width:100%; padding:12px; background:var(--primary-color); color:white; border:none; border-radius:12px; font-weight:600 }

/* FIX: Word Card Layout */
.word-card-header{ display:flex; align-items:center; gap:12px }
#word-card-title{ margin:0; font-size:1.6rem }
.pitch-accent{ font-size:0.95rem; font-weight:700; color:var(--primary-color); border:2px solid rgba(91,140,255,0.18); border-radius:8px; padding:6px }
.hiragana-reading{ font-size:1rem; color:var(--text-color-muted); margin:6px 0 }
.pos-details-container{ margin-bottom:1rem; display:flex; flex-wrap:wrap; gap:8px }
.pos-detail-item{ background:rgba(15,23,36,0.04); color:var(--text-color-main); padding:6px 10px; border-radius:10px }
#word-card-pronounce-button{ background:var(--accent-color); color:#063018; border:none; padding:8px 12px; border-radius:10px; cursor:pointer; margin-bottom:10px }
.word-card-section { margin-bottom: 1.5rem; }
.word-card-section strong {
    color: var(--text-color-main);
    display: inline-block;
    margin-bottom: 0.75rem;
    font-weight: 700;
}
#word-card-examples { list-style-type: none; padding-left: 0; }
#word-card-examples li {
    background-color: var(--background-color);
    padding: 1rem;
    border-radius: var(--border-radius);
    margin-bottom: 0.75rem;
    border: 1px solid var(--border-color);
}
#word-card-examples .reading { font-size: 0.8rem; color: var(--text-color-muted); }
#word-card-examples .translation { font-size: 0.95rem; color: #059669; font-style: normal; }
#close-word-card-button{ background:rgba(15,23,36,0.06); color:var(--text-color-main) }

/* Responsive adjustments */
@media (max-width:720px){
    .container{ padding:1rem }
    #conversation-area{ height:56vh }
    .brand{ gap:10px }
    .logo{ font-size:26px }
}